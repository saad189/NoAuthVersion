<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Macro Panel</title>
    <style>
      :root {
        --primary: #e11d48;
        --primary-dark: #be123c;
        --secondary: #f43f5e;
        --dark: #0f0f0f;
        --light: #f8fafc;
        --host-color: #f97316;
        --player-color: #3b82f6;
        --selected-color: #22c55e;
        --controlbar-gradient-start: #881337;
        --controlbar-gradient-end: #b91c1c;
      }

      body {
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        background-color: var(--dark);
        color: var(--light);
        margin: 0;
        padding: 0;
        min-height: 100vh;
        box-sizing: border-box;
      }

      h1 {
        text-align: center;
        font-size: 20px;
        margin: 0;
        color: var(--light);
        padding: 10px 0;
        background: linear-gradient(
          to right,
          var(--controlbar-gradient-start),
          var(--controlbar-gradient-end)
        );
        box-shadow: 0 1px 4px rgba(0, 0, 0, 0.3);
      }

      .macro-container {
        display: flex;
        flex-direction: column;
        gap: 10px;
        max-width: 800px;
        margin: 0 auto;
        padding: 10px;
      }

      .game-mode-indicator {
        text-align: center;
        font-size: 16px;
        margin: 10px 0;
        font-weight: bold;
        background-color: rgba(255, 255, 255, 0.1);
        padding: 5px;
        border-radius: 4px;
      }

      .macro-grid {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 10px;
        margin-top: 10px;
      }

      .macro-btn {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        background-color: #333;
        border: 1px solid #555;
        color: white;
        padding: 12px;
        border-radius: 5px;
        cursor: pointer;
        transition: all 0.2s ease;
        min-height: 80px;
        text-align: center;
      }

      .macro-btn:hover {
        background-color: #444;
        border-color: var(--secondary);
      }

      .macro-btn.active {
        background-color: var(--primary-dark);
        border-color: var(--selected-color);
        box-shadow: 0 0 10px rgba(34, 197, 94, 0.3);
      }

      .macro-name {
        font-weight: bold;
        margin-bottom: 5px;
      }

      .macro-shortcut {
        font-size: 12px;
        opacity: 0.8;
      }

      .macro-description {
        font-size: 11px;
        margin-top: 5px;
        opacity: 0.7;
      }

      .no-macros {
        text-align: center;
        padding: 20px;
        background-color: rgba(255, 255, 255, 0.05);
        border-radius: 5px;
        margin-top: 20px;
      }
    </style>
  </head>
  <body>
    <div class="macro-container">
      <h1>Macro Panel</h1>

      <div id="game-mode-indicator" class="game-mode-indicator">Loading...</div>

      <div id="macro-grid" class="macro-grid">
        <!-- Macros will be generated here dynamically -->
      </div>

      <div id="no-macros" class="no-macros" style="display: none">
        No macros available for this game mode.
      </div>
    </div>

    <script>
      document.addEventListener("DOMContentLoaded", () => {
        // Get game mode from URL parameters
        const urlParams = new URLSearchParams(window.location.search);
        const gameMode = urlParams.get("mode") || "multiplayer";

        // Macro configurations by game mode
        const macrosByMode = {
          // Macros for Multiplayer and CDL (identical)
          multiplayer: [
            {
              id: "macro1",
              name: "Multi-Search",
              shortcut: "ALT+1",
              description: "Press R in all views",
              icon: "🔍",
            },
            {
              id: "macro2",
              name: "Abandon & Next",
              shortcut: "ALT+2",
              description: "Sequence: Escape, Tab x2, Enter",
              icon: "⏭️",
            },
            {
              id: "macro3",
              name: "Fullscreen",
              shortcut: "ALT+3",
              description: "Toggle fullscreen (F11)",
              icon: "📺",
            },
            {
              id: "macro4",
              name: "Auto Movement",
              shortcut: "ALT+M",
              description: "Enable/disable automatic movements",
              icon: "🔄",
              toggleable: true,
            },
          ],

          // Copy the same macros for CDL
          cdl: [],

          // Warzone - add only the automatic movements macro
          warzone: [
            {
              id: "macro4",
              name: "Auto Movement",
              shortcut: "ALT+M",
              description: "Enable/disable automatic movements",
              icon: "🔄",
              toggleable: true,
            },
          ],

          // Warzone - specific macros for Warzone mode
          warzone: [
            {
              id: "macro5",
              name: "Auto Drop",
              shortcut: "ALT+D",
              description: "Space on Hosts then Players after 0.3s",
              icon: "🪂",
              toggleable: false,
            },
            {
              id: "macro6",
              name: "AFK Host",
              shortcut: "ALT+H",
              description: "Movement on Hosts (1s press, 2s pause)",
              icon: "🏠",
              toggleable: true,
            },
            {
              id: "macro7",
              name: "AFK Player",
              shortcut: "ALT+P",
              description: "Movement on Players (0.6s press, 1s pause)",
              icon: "👤",
              toggleable: true,
            },
            {
              id: "macro8",
              name: "AFK Host+Player",
              shortcut: "ALT+A",
              description:
                "Maintains activity on hosts and players by performing a sequence of ZQSD movements and V (knife strike) presses every 3 seconds on players only. Automatically restarts every 60 seconds to avoid bugs.",
              icon: "👥",
              toggleable: true,
            },
          ],
        };

        // Copy multiplayer macros to cdl (identical)
        macrosByMode.cdl = [...macrosByMode.multiplayer];

        // Update game mode indicator
        const modeNames = {
          multiplayer: "Multiplayer",
          cdl: "CDL",
          warzone: "Warzone",
        };

        document.getElementById("game-mode-indicator").textContent = `Mode: ${
          modeNames[gameMode] || gameMode
        }`;

        // Get macros for this game mode
        const macros = macrosByMode[gameMode] || [];

        // Display message if no macros available
        if (macros.length === 0) {
          document.getElementById("no-macros").style.display = "block";
          document.getElementById("macro-grid").style.display = "none";
        } else {
          document.getElementById("no-macros").style.display = "none";
          document.getElementById("macro-grid").style.display = "grid";

          // Generate macro buttons
          const macroGrid = document.getElementById("macro-grid");
          macroGrid.innerHTML = "";

          macros.forEach((macro) => {
            const btn = document.createElement("div");
            btn.className = "macro-btn";
            btn.id = macro.id;
            btn.dataset.id = macro.id;
            btn.dataset.toggleable = macro.toggleable || false;

            const nameEl = document.createElement("div");
            nameEl.className = "macro-name";
            nameEl.textContent = `${macro.icon || ""} ${macro.name}`;

            const shortcutEl = document.createElement("div");
            shortcutEl.className = "macro-shortcut";
            shortcutEl.textContent = macro.shortcut;

            const descEl = document.createElement("div");
            descEl.className = "macro-description";
            descEl.textContent = macro.description;

            btn.appendChild(nameEl);
            btn.appendChild(shortcutEl);
            btn.appendChild(descEl);

            // Add click event
            btn.addEventListener("click", () => {
              // For toggleable macros, toggle active class
              if (macro.toggleable) {
                btn.classList.toggle("active");
              } else {
                // Temporary visual effect for non-toggleable macros
                btn.classList.add("active");
                setTimeout(() => btn.classList.remove("active"), 500);
              }

              // Execute macro via API
              if (window.macroAPI) {
                window.macroAPI.executeMacro(macro.id, gameMode);
              }
            });

            if (macro.id === "macro8" || macro.name === "AFK Host+Player") {
              macro.description =
                "Maintains activity on hosts and players by performing a sequence of ZQSD movements and V (knife strike) presses every 3 seconds on players only. Automatically restarts every 60 seconds to avoid bugs.";
            }

            macroGrid.appendChild(btn);
          });
        }

        // Listen for macro status updates
        if (window.macroAPI && window.macroAPI.onMacroStatus) {
          window.macroAPI.onMacroStatus((status) => {
            const macroBtn = document.getElementById(status.macroId);
            if (macroBtn && macroBtn.dataset.toggleable === "true") {
              if (status.running) {
                macroBtn.classList.add("active");
              } else {
                macroBtn.classList.remove("active");
              }
            }
          });
        }

        // If API available, request macros from main process
        if (window.macroAPI && window.macroAPI.requestMacros) {
          window.macroAPI.requestMacros(gameMode);

          // Listen for available macros updates
          if (window.macroAPI.onMacrosLoaded) {
            window.macroAPI.onMacrosLoaded((macrosData) => {
              // This function would allow dynamically updating the macros if implemented in backend
              console.log("Macros updated:", macrosData);
            });
          }
        }
      });
    </script>
  </body>
</html>
